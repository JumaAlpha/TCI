<!-- Gallery Section -->
<section class="gallery-section">
    <div class="gallery-particles" id="galleryParticles"></div>
    <h2 class="gallery-title">Our Gallery</h2>
    
    <!-- Category Navigation Images in Row Layout -->
    <div class="gallery-categories-row">
        <div class="category-row-item" data-category="prophetic">
            <div class="category-row-image">
                <img src="https://images.unsplash.com/photo-1567593810070-7a5c0925344e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" 
                     alt="Prophetic Ministry">
                <div class="category-row-overlay">
                    <h3 class="category-row-title">Prophetic</h3>
                    <p class="category-row-subtitle">Moments of divine revelation and spiritual guidance</p>
                    <div class="category-row-arrow">→</div>
                </div>
            </div>
        </div>
        
        <div class="category-row-item" data-category="praise-worship">
            <div class="category-row-image">
                <img src="https://images.unsplash.com/photo-1511379938547-c1f69419868d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" 
                     alt="Praise & Worship">
                <div class="category-row-overlay">
                    <h3 class="category-row-title">Praise & Worship</h3>
                    <p class="category-row-subtitle">Celebrating God's presence through music and dance</p>
                    <div class="category-row-arrow">→</div>
                </div>
            </div>
        </div>
        
        <div class="category-row-item" data-category="community">
            <div class="category-row-image">
                <img src="https://images.unsplash.com/photo-1544809046-bb4777a241c9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" 
                     alt="Community Fellowship">
                <div class="category-row-overlay">
                    <h3 class="category-row-title">Community</h3>
                    <p class="category-row-subtitle">Building relationships and sharing life together</p>
                    <div class="category-row-arrow">→</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Gallery Content Container (Initially Hidden) -->
    <div class="gallery-content-container" id="galleryContent">
        <div class="gallery-back-button" id="galleryBackBtn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            <span>Back to Categories</span>
        </div>
        
        <h3 class="gallery-category-title" id="categoryTitle">Gallery</h3>
        
        <!-- Carousel Container -->
        <div class="gallery-carousel-container">
            <!-- Carousel Wrapper -->
            <div class="gallery-carousel">
                <!-- Images will be loaded dynamically based on category -->
            </div>
            
            <!-- Navigation Arrows -->
            <button class="carousel-arrow carousel-arrow-prev" aria-label="Previous image">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            <button class="carousel-arrow carousel-arrow-next" aria-label="Next image">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
        </div>
    </div>
</section>

<style>
/* GALLERY SECTION WITH ROW LAYOUT CATEGORIES */
.gallery-section {
    position: absolute;
    top: 300vh;
    left: 0;
    width: 100%;
    min-height: 100vh;
    background: #000;
    z-index: 3;
    padding: 80px 20px;
    overflow: hidden;
    transition: opacity 1s ease;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.gallery-title {
    font-size: clamp(3rem, 8vw, 6rem);
    font-weight: 900;
    color: var(--lime-green);
    text-align: center;
    margin-bottom: 60px;
    opacity: 0;
    transform: translateY(30px);
    transition: all 1s ease 0.3s;
    position: relative;
    z-index: 1;
}

.gallery-title.visible {
    opacity: 1;
    transform: translateY(0);
}

/* Category Navigation in Row Layout */
.gallery-categories-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 30px;
    max-width: 1400px;
    margin: 0 auto;
    width: 100%;
    padding: 0 20px;
}

.category-row-item {
    flex: 1;
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    height: 450px;
    min-width: 300px;
    -webkit-tap-highlight-color: transparent;
}

.category-row-item:hover {
    transform: translateY(-15px);
    box-shadow: 0 40px 80px rgba(0, 0, 0, 0.7);
}

.category-row-image {
    position: relative;
    width: 100%;
    height: 100%;
}

.category-row-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.8s ease;
}

.category-row-item:hover .category-row-image img {
    transform: scale(1.15);
}

.category-row-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    padding: 40px 30px;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.7));
    color: var(--white);
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    opacity: 1;
    transition: all 0.4s ease;
}

.category-row-title {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 15px;
    color: var(--lime-green);
    text-transform: uppercase;
    letter-spacing: 2px;
    transform: translateY(0);
    transition: transform 0.4s ease;
}

.category-row-subtitle {
    font-size: 1.2rem;
    opacity: 0.9;
    line-height: 1.4;
    max-width: 90%;
    margin-bottom: 20px;
    transform: translateY(0);
    transition: transform 0.4s ease 0.1s;
}

.category-row-arrow {
    font-size: 2.5rem;
    color: var(--orange);
    font-weight: 900;
    opacity: 0;
    transform: translateX(-20px);
    transition: all 0.4s ease 0.2s;
}

.category-row-item:hover .category-row-title {
    transform: translateY(-10px);
}

.category-row-item:hover .category-row-subtitle {
    transform: translateY(-10px);
}

.category-row-item:hover .category-row-arrow {
    opacity: 1;
    transform: translateX(0);
}

/* Gallery Content Container */
.gallery-content-container {
    display: none;
    max-width: 1400px;
    margin: 0 auto;
    width: 100%;
    padding: 0 20px;
}

.gallery-content-container.active {
    display: block;
    animation: fadeIn 0.6s ease forwards;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Back Button */
.gallery-back-button {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    color: var(--orange);
    font-size: 1.2rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    margin-bottom: 40px;
    padding: 10px 20px;
    border: 2px solid var(--orange);
    border-radius: 50px;
    transition: all 0.3s ease;
    background: rgba(255, 140, 0, 0.1);
}

.gallery-back-button:hover {
    background: var(--orange);
    color: #000;
    transform: translateX(-5px);
}

.gallery-back-button svg {
    width: 20px;
    height: 20px;
    transition: transform 0.3s ease;
}

.gallery-back-button:hover svg {
    transform: translateX(-3px);
}

/* Category Title */
.gallery-category-title {
    font-size: clamp(2.5rem, 6vw, 4rem);
    font-weight: 900;
    color: var(--lime-green);
    margin-bottom: 40px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
}

/* Carousel Container */
.gallery-carousel-container {
    position: relative;
    width: 100%;
    overflow: visible;
}

/* Carousel Track */
.gallery-carousel {
    display: flex;
    gap: 30px;
    scroll-behavior: smooth;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    padding: 20px 0 40px;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
    cursor: grab;
}

.gallery-carousel::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
}

.gallery-carousel.dragging {
    scroll-behavior: auto;
    cursor: grabbing;
}

/* Carousel Items */
.gallery-carousel-item {
    flex: 0 0 calc(33.333% - 20px);
    scroll-snap-align: start;
    min-height: 500px;
    opacity: 0.4;
    transform: scale(0.95);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
}

.gallery-carousel-item.active {
    opacity: 1;
    transform: scale(1);
    z-index: 2;
}

.gallery-carousel-item:hover {
    transform: scale(1.02);
}

.carousel-image-container {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 500px;
    overflow: hidden;
    border-radius: 20px;
}

.carousel-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.8s ease;
}

.gallery-carousel-item:hover .carousel-img {
    transform: scale(1.1);
}

/* Carousel Overlay */
.carousel-text-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 40px 30px;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.95), transparent);
    color: var(--white);
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.6s ease;
}

.gallery-carousel-item.active .carousel-text-overlay,
.gallery-carousel-item:hover .carousel-text-overlay {
    opacity: 1;
    transform: translateY(0);
}

.carousel-caption {
    font-size: 2rem;
    font-weight: 900;
    margin-bottom: 10px;
    color: var(--lime-green);
    text-transform: uppercase;
    letter-spacing: 2px;
}

.carousel-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    line-height: 1.4;
    max-width: 80%;
}

/* Navigation Arrows */
.carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 60px;
    height: 60px;
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid var(--lime-green);
    border-radius: 50%;
    color: var(--lime-green);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    z-index: 10;
    opacity: 0.7;
}

.carousel-arrow:hover {
    background: var(--lime-green);
    color: #000;
    transform: translateY(-50%) scale(1.1);
    opacity: 1;
}

.carousel-arrow-prev {
    left: -30px;
}

.carousel-arrow-next {
    right: -30px;
}

.carousel-arrow svg {
    width: 24px;
    height: 24px;
}

/* Hide categories when gallery is active */
.gallery-categories-row.hidden {
    display: none;
}

/* Responsive Design - Row Layout */
@media (max-width: 1200px) {
    .gallery-categories-row {
        gap: 20px;
    }
    
    .category-row-item {
        height: 400px;
        min-width: 250px;
    }
    
    .category-row-title {
        font-size: 2rem;
    }
    
    .category-row-subtitle {
        font-size: 1rem;
    }
    
    .gallery-carousel-item {
        flex: 0 0 calc(50% - 15px);
        min-height: 450px;
    }
    
    .carousel-caption {
        font-size: 1.8rem;
    }
}

@media (max-width: 900px) {
    .gallery-categories-row {
        flex-direction: column;
        gap: 25px;
        max-width: 600px;
    }
    
    .category-row-item {
        width: 100%;
        height: 350px;
        min-width: auto;
    }
    
    .category-row-overlay {
        padding: 30px 25px;
    }
    
    .category-row-title {
        font-size: 2.2rem;
    }
    
    .category-row-subtitle {
        font-size: 1.1rem;
    }
}

@media (max-width: 768px) {
    .gallery-section {
        padding: 60px 15px;
    }
    
    .gallery-categories-row {
        gap: 20px;
    }
    
    .category-row-item {
        height: 320px;
    }
    
    .category-row-overlay {
        padding: 25px 20px;
    }
    
    .category-row-title {
        font-size: 1.8rem;
        margin-bottom: 10px;
    }
    
    .category-row-subtitle {
        font-size: 1rem;
        margin-bottom: 15px;
    }
    
    .category-row-arrow {
        font-size: 2rem;
    }
    
    .gallery-carousel-container {
        padding: 0;
    }
    
    .gallery-carousel {
        gap: 20px;
        padding-bottom: 30px;
    }
    
    .gallery-carousel-item {
        flex: 0 0 calc(100% - 40px);
        min-height: 400px;
    }
    
    .carousel-image-container {
        min-height: 400px;
    }
    
    .carousel-caption {
        font-size: 1.6rem;
    }
    
    .carousel-subtitle {
        font-size: 1rem;
    }
    
    .carousel-arrow {
        width: 50px;
        height: 50px;
    }
    
    .carousel-arrow-prev {
        left: -20px;
    }
    
    .carousel-arrow-next {
        right: -20px;
    }
}

@media (max-width: 480px) {
    .gallery-section {
        padding: 40px 10px;
    }
    
    .gallery-categories-row {
        gap: 15px;
    }
    
    .category-row-item {
        height: 280px;
    }
    
    .category-row-overlay {
        padding: 20px 15px;
    }
    
    .category-row-title {
        font-size: 1.5rem;
        letter-spacing: 1px;
    }
    
    .category-row-subtitle {
        font-size: 0.9rem;
    }
    
    .category-row-arrow {
        font-size: 1.8rem;
    }
    
    .gallery-back-button {
        font-size: 1rem;
        padding: 8px 16px;
    }
    
    .gallery-category-title {
        font-size: clamp(2rem, 5vw, 3rem);
        margin-bottom: 30px;
    }
    
    .gallery-carousel {
        gap: 15px;
    }
    
    .gallery-carousel-item {
        flex: 0 0 calc(100% - 30px);
        min-height: 350px;
    }
    
    .carousel-image-container {
        min-height: 350px;
    }
    
    .carousel-caption {
        font-size: 1.4rem;
        padding: 0 20px;
    }
    
    .carousel-text-overlay {
        padding: 30px 20px;
    }
    
    .carousel-arrow {
        width: 40px;
        height: 40px;
    }
    
    .carousel-arrow svg {
        width: 20px;
        height: 20px;
    }
    
    .carousel-arrow-prev {
        left: -15px;
    }
    
    .carousel-arrow-next {
        right: -15px;
    }
}

/* For very small screens */
@media (max-width: 360px) {
    .category-row-item {
        height: 250px;
    }
    
    .category-row-title {
        font-size: 1.3rem;
    }
    
    .category-row-subtitle {
        font-size: 0.85rem;
    }
}
</style>

<script>
// Gallery with Row Layout Categories
(function() {
    'use strict';
    
    // Gallery data for each category
    const galleryData = {
        'prophetic': [
            {
                image: 'https://images.unsplash.com/photo-1567593810070-7a5c0925344e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Prophetic Worship',
                subtitle: 'Divine encounters during worship sessions'
            },
            {
                image: 'https://images.unsplash.com/photo-1577486643317-4c9305f3d89d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Spiritual Guidance',
                subtitle: 'Moments of prophetic revelation and direction'
            },
            {
                image: 'https://images.unsplash.com/photo-1511497584788-876760111969?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Prayer Gatherings',
                subtitle: 'Corporate prayer and intercession sessions'
            },
            {
                image: 'https://images.unsplash.com/photo-1542401886-65d6c61db217?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Ministry Sessions',
                subtitle: 'Prophetic ministry and personal prayer'
            },
            {
                image: 'https://images.unsplash.com/photo-1528164344705-47542687000d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Spiritual Breakthrough',
                subtitle: 'Moments of breakthrough and deliverance'
            },
            {
                image: 'https://images.unsplash.com/photo-1510832842230-87253f48d74f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Healing Ministry',
                subtitle: 'Divine healing and restoration moments'
            }
        ],
        'praise-worship': [
            {
                image: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Live Worship Band',
                subtitle: 'Our talented worship team in action'
            },
            {
                image: 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Choir Performances',
                subtitle: 'Harmonious voices praising together'
            },
            {
                image: 'https://images.unsplash.com/photo-1518609878373-06d740f60d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Dance Ministry',
                subtitle: 'Expressive worship through dance'
            },
            {
                image: 'https://images.unsplash.com/photo-1511735111819-9a3f7709049c?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Youth Worship',
                subtitle: 'Young people passionate for God'
            },
            {
                image: 'https://images.unsplash.com/photo-1459749411175-04bf5292ceea?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Night of Worship',
                subtitle: 'Extended worship and prayer nights'
            },
            {
                image: 'https://images.unsplash.com/photo-1510915361894-db8b60106cb1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Instruments of Praise',
                subtitle: 'Musical excellence for God\'s glory'
            }
        ],
        'community': [
            {
                image: 'https://images.unsplash.com/photo-1544809046-bb4777a241c9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Fellowship Meals',
                subtitle: 'Sharing meals and building relationships'
            },
            {
                image: 'https://images.unsplash.com/photo-1542744173-8e7e53415bb0?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Community Outreach',
                subtitle: 'Serving and impacting our local community'
            },
            {
                image: 'https://images.unsplash.com/photo-1511988617509-a57c8a288659?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Small Groups',
                subtitle: 'Intimate fellowship and Bible study'
            },
            {
                image: 'https://images.unsplash.com/photo-1529156069898-49953e39b3ac?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Youth Activities',
                subtitle: 'Young people connecting and growing'
            },
            {
                image: 'https://images.unsplash.com/photo-1577896851231-70ef18881754?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Family Events',
                subtitle: 'Church family bonding and fun'
            },
            {
                image: 'https://images.unsplash.com/photo-1545235617-9465d2a55698?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80',
                title: 'Volunteer Teams',
                subtitle: 'Serving together in various ministries'
            }
        ]
    };
    
    // Category titles for display
    const categoryTitles = {
        'prophetic': 'Prophetic Ministry Gallery',
        'praise-worship': 'Praise & Worship Gallery',
        'community': 'Community Fellowship Gallery'
    };
    
    document.addEventListener('DOMContentLoaded', function() {
        // Wait for gallery to be loaded
        setTimeout(initGallery, 100);
    });
    
    function initGallery() {
        // Elements
        const categoryItems = document.querySelectorAll('.category-row-item');
        const galleryContent = document.getElementById('galleryContent');
        const galleryBackBtn = document.getElementById('galleryBackBtn');
        const categoryTitle = document.getElementById('categoryTitle');
        const galleryCategories = document.querySelector('.gallery-categories-row');
        const carousel = document.querySelector('.gallery-carousel');
        const prevBtn = document.querySelector('.carousel-arrow-prev');
        const nextBtn = document.querySelector('.carousel-arrow-next');
        const galleryTitle = document.querySelector('.gallery-title');
        
        // State
        let currentCategory = '';
        let currentIndex = 0;
        let isDragging = false;
        let startX = 0;
        let scrollLeft = 0;
        let galleryShown = false;
        
        // Initialize
        setupGallery();
        
        function setupGallery() {
            // Add event listeners
            addEventListeners();
            
            // Set up scroll detection for animation
            setupScrollDetection();
        }
        
        function addEventListeners() {
            // Category item clicks
            categoryItems.forEach(item => {
                item.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    openGallery(category);
                });
                
                // Touch support for mobile
                item.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    const category = this.getAttribute('data-category');
                    openGallery(category);
                });
            });
            
            // Back button
            galleryBackBtn.addEventListener('click', closeGallery);
            
            // Carousel navigation
            if (prevBtn) {
                prevBtn.addEventListener('click', () => navigateCarousel(-1));
            }
            
            if (nextBtn) {
                nextBtn.addEventListener('click', () => navigateCarousel(1));
            }
            
            // Carousel drag for desktop
            if (carousel) {
                carousel.addEventListener('mousedown', startDrag);
                carousel.addEventListener('mousemove', drag);
                carousel.addEventListener('mouseup', endDrag);
                carousel.addEventListener('mouseleave', endDrag);
                
                // Touch events for mobile
                carousel.addEventListener('touchstart', startDragTouch);
                carousel.addEventListener('touchmove', dragTouch);
                carousel.addEventListener('touchend', endDrag);
                
                // Wheel scrolling
                carousel.addEventListener('wheel', handleWheel);
            }
            
            // Keyboard navigation
            document.addEventListener('keydown', handleKeydown);
        }
        
        function openGallery(category) {
            if (!galleryData[category]) return;
            
            currentCategory = category;
            
            // Hide categories, show gallery content
            galleryCategories.classList.add('hidden');
            galleryContent.classList.add('active');
            
            // Set category title
            categoryTitle.textContent = categoryTitles[category] || 'Gallery';
            
            // Load carousel items
            loadCarouselItems(category);
            
            // Update URL hash for deep linking
            window.location.hash = `gallery-${category}`;
        }
        
        function closeGallery() {
            // Show categories, hide gallery content
            galleryCategories.classList.remove('hidden');
            galleryContent.classList.remove('active');
            
            // Clear current category
            currentCategory = '';
            currentIndex = 0;
            
            // Clear URL hash
            if (window.location.hash.includes('gallery-')) {
                window.history.replaceState(null, null, ' ');
            }
        }
        
        function loadCarouselItems(category) {
            if (!carousel || !galleryData[category]) return;
            
            // Clear existing items
            carousel.innerHTML = '';
            
            // Create new items
            galleryData[category].forEach((item, index) => {
                const carouselItem = document.createElement('div');
                carouselItem.className = `gallery-carousel-item ${index === 0 ? 'active' : ''}`;
                carouselItem.setAttribute('data-index', index);
                
                carouselItem.innerHTML = `
                    <div class="carousel-image-container">
                        <img src="${item.image}" 
                             alt="${item.title}" 
                             class="carousel-img"
                             loading="lazy">
                        <div class="carousel-text-overlay">
                            <h3 class="carousel-caption">${item.title}</h3>
                            <p class="carousel-subtitle">${item.subtitle}</p>
                        </div>
                    </div>
                `;
                
                carousel.appendChild(carouselItem);
            });
            
            // Update carousel functionality
            updateCarousel();
        }
        
        function updateCarousel() {
            const carouselItems = document.querySelectorAll('.gallery-carousel-item');
            
            // Reset index
            currentIndex = 0;
            
            // Set first item as active
            updateActiveItem(0);
        }
        
        function navigateCarousel(direction) {
            const carouselItems = document.querySelectorAll('.gallery-carousel-item');
            if (carouselItems.length === 0) return;
            
            let newIndex = currentIndex + direction;
            
            if (newIndex < 0) newIndex = carouselItems.length - 1;
            if (newIndex >= carouselItems.length) newIndex = 0;
            
            currentIndex = newIndex;
            
            // Scroll to the slide
            const itemWidth = carouselItems[0].offsetWidth + 30; // width + gap
            carousel.scrollLeft = itemWidth * newIndex;
            
            // Update active item
            updateActiveItem(newIndex);
        }
        
        function updateActiveItem(index) {
            const carouselItems = document.querySelectorAll('.gallery-carousel-item');
            
            // Remove active class from all items
            carouselItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to current item
            if (carouselItems[index]) {
                carouselItems[index].classList.add('active');
            }
        }
        
        // Carousel drag functions
        function startDrag(e) {
            isDragging = true;
            carousel.classList.add('dragging');
            startX = e.pageX - carousel.offsetLeft;
            scrollLeft = carousel.scrollLeft;
        }
        
        function drag(e) {
            if (!isDragging) return;
            e.preventDefault();
            const x = e.pageX - carousel.offsetLeft;
            const walk = (x - startX) * 2;
            carousel.scrollLeft = scrollLeft - walk;
            updateActiveFromScroll();
        }
        
        function startDragTouch(e) {
            isDragging = true;
            carousel.classList.add('dragging');
            startX = e.touches[0].pageX - carousel.offsetLeft;
            scrollLeft = carousel.scrollLeft;
        }
        
        function dragTouch(e) {
            if (!isDragging) return;
            const x = e.touches[0].pageX - carousel.offsetLeft;
            const walk = (x - startX) * 2;
            carousel.scrollLeft = scrollLeft - walk;
            updateActiveFromScroll();
        }
        
        function endDrag() {
            isDragging = false;
            carousel.classList.remove('dragging');
            snapToNearestSlide();
        }
        
        function updateActiveFromScroll() {
            const carouselItems = document.querySelectorAll('.gallery-carousel-item');
            if (carouselItems.length === 0) return;
            
            const scrollPosition = carousel.scrollLeft;
            const itemWidth = carouselItems[0].offsetWidth + 30;
            const newIndex = Math.round(scrollPosition / itemWidth);
            
            if (newIndex !== currentIndex) {
                currentIndex = Math.max(0, Math.min(newIndex, carouselItems.length - 1));
                updateActiveItem(currentIndex);
            }
        }
        
        function snapToNearestSlide() {
            const carouselItems = document.querySelectorAll('.gallery-carousel-item');
            if (carouselItems.length === 0) return;
            
            const scrollPosition = carousel.scrollLeft;
            const itemWidth = carouselItems[0].offsetWidth + 30;
            const newIndex = Math.round(scrollPosition / itemWidth);
            
            navigateCarousel(newIndex - currentIndex);
        }
        
        function handleWheel(e) {
            if (!carousel) return;
            
            // Prevent vertical scrolling
            if (Math.abs(e.deltaX) < Math.abs(e.deltaY)) {
                e.preventDefault();
            }
            
            // Smooth horizontal scrolling with wheel
            carousel.scrollLeft += e.deltaY * 0.5;
            updateActiveFromScroll();
        }
        
        function handleKeydown(e) {
            if (!currentCategory) return;
            
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                navigateCarousel(-1);
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                navigateCarousel(1);
            } else if (e.key === 'Escape') {
                closeGallery();
            }
        }
        
        function setupScrollDetection() {
            let ticking = false;
            
            function checkScroll() {
                const scrollY = window.pageYOffset || document.documentElement.scrollTop;
                const heroHeight = window.innerHeight;
                const galleryProgress = Math.min(Math.max((scrollY - heroHeight * 2.5) / (heroHeight * 0.5), 0), 1);
                
                // Show gallery title
                if (galleryProgress > 0.2 && !galleryShown) {
                    galleryShown = true;
                    galleryTitle.classList.add('visible');
                } else if (galleryProgress <= 0.2 && galleryShown) {
                    galleryShown = false;
                    galleryTitle.classList.remove('visible');
                }
                
                ticking = false;
            }
            
            window.addEventListener('scroll', function() {
                if (!ticking) {
                    window.requestAnimationFrame(checkScroll);
                    ticking = true;
                }
            });
            
            // Check URL hash on load
            checkHash();
            
            // Initial check
            checkScroll();
        }
        
        function checkHash() {
            const hash = window.location.hash;
            if (hash.includes('gallery-')) {
                const category = hash.replace('#gallery-', '');
                if (galleryData[category]) {
                    // Small delay to ensure DOM is ready
                    setTimeout(() => {
                        openGallery(category);
                    }, 300);
                }
            }
        }
        
        // Handle browser back button
        window.addEventListener('popstate', function() {
            if (!window.location.hash.includes('gallery-') && currentCategory) {
                closeGallery();
            }
        });
    }
})();
</script>